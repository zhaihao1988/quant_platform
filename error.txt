2025-05-05 01:00:27,064 - __main__ - INFO - .env file loaded (if exists).
2025-05-05 01:00:27,065 - __main__ - INFO - --- Starting Stock Analysis for: 000887 ---
2025-05-05 01:00:27,065 - db.database - INFO - Creating database tables if they don't exist...
2025-05-05 01:00:27,263 - db.database - INFO - Database tables checked/created successfully.
2025-05-05 01:00:27,263 - __main__ - INFO - --- Starting Data Processing for: 000887 ---
2025-05-05 01:00:27,263 - data_processing.loader - INFO - Querying database for disclosures needing content for symbol: 000887
2025-05-05 01:00:27,273 - data_processing.loader - ERROR - Error querying disclosures needing content for 000887: (psycopg2.errors.UndefinedColumn) 错误:  字段 stock_disclosure.raw_content 不存在
LINE 1: ...te, stock_disclosure.url AS stock_disclosure_url, stock_disc...
                                                             ^

[SQL: SELECT stock_disclosure.id AS stock_disclosure_id, stock_disclosure.symbol AS stock_disclosure_symbol, stock_disclosure.short_name AS stock_disclosure_short_name, stock_disclosure.title AS stock_disclosure_title, stoc
k_disclosure.ann_date AS stock_disclosure_ann_date, stock_disclosure.url AS stock_disclosure_url, stock_disclosure.raw_content AS stock_disclosure_raw_content, stock_disclosure.content_vector AS stock_disclosure_content_vector
FROM stock_disclosure
WHERE stock_disclosure.symbol = %(symbol_1)s AND stock_disclosure.raw_content IS NULL AND (stock_disclosure.title ILIKE %(title_1)s OR stock_disclosure.title ILIKE %(title_2)s OR stock_disclosure.title ILIKE %(title_3)s OR stock_disclosure.title ILIKE %(title_4)s OR stock_disclosure.title ILIKE %(title_5)s) ORDER BY stock_disclosure.ann_date DESC]
[parameters: {'symbol_1': '000887', 'title_1': '%年度报告%', 'title_2': '%半年度报告%', 'title_3': '%调研%', 'title_4': '%股权激励%', 'title_5': '%回购%'}]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "D:\project\quant_platform\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "D:\project\quant_platform\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.UndefinedColumn: 错误:  字段 stock_disclosure.raw_content 不存在
LINE 1: ...te, stock_disclosure.url AS stock_disclosure_url, stock_disc...
                                                             ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\project\quant_platform\data_processing\loader.py", line 86, in get_disclosures_needing_content
    ).order_by(StockDisclosure.ann_date.desc()).all() # Process recent ones first
                                                ^^^^^
  File "D:\project\quant_platform\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2704, in all
    return self._iter().all()  # type: ignore
           ^^^^^^^^^^^^
  File "D:\project\quant_platform\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2858, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "D:\project\quant_platform\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\project\quant_platform\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\project\quant_platform\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "D:\project\quant_platform\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "D:\project\quant_platform\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\project\quant_platform\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "D:\project\quant_platform\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\project\quant_platform\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\project\quant_platform\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\project\quant_platform\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "D:\project\quant_platform\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) 错误:  字段 stock_disclosure.raw_content 不存在
LINE 1: ...te, stock_disclosure.url AS stock_disclosure_url, stock_disc...
                                                             ^

[SQL: SELECT stock_disclosure.id AS stock_disclosure_id, stock_disclosure.symbol AS stock_disclosure_symbol, stock_disclosure.short_name AS stock_disclosure_short_name, stock_disclosure.title AS stock_disclosure_title, stoc
k_disclosure.ann_date AS stock_disclosure_ann_date, stock_disclosure.url AS stock_disclosure_url, stock_disclosure.raw_content AS stock_disclosure_raw_content, stock_disclosure.content_vector AS stock_disclosure_content_vector
FROM stock_disclosure
WHERE stock_disclosure.symbol = %(symbol_1)s AND stock_disclosure.raw_content IS NULL AND (stock_disclosure.title ILIKE %(title_1)s OR stock_disclosure.title ILIKE %(title_2)s OR stock_disclosure.title ILIKE %(title_3)s OR stock_disclosure.title ILIKE %(title_4)s OR stock_disclosure.title ILIKE %(title_5)s) ORDER BY stock_disclosure.ann_date DESC]
[parameters: {'symbol_1': '000887', 'title_1': '%年度报告%', 'title_2': '%半年度报告%', 'title_3': '%调研%', 'title_4': '%股权激励%', 'title_5': '%回购%'}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-05-05 01:00:27,411 - __main__ - INFO - No new disclosures requiring processing found for 000887.
2025-05-05 01:00:27,411 - __main__ - INFO - --- Starting Report Generation for: 000887 ---
2025-05-05 01:00:27,412 - core.prompting - INFO - --- Starting Report Generation for: 000887 ---
2025-05-05 01:00:27,415 - core.prompting - INFO - Processing: 中鼎股份 (000887), Industry: None
2025-05-05 01:00:27,415 - data_processing.loader - INFO - Loading price data for 000887, window=5 days.
2025-05-05 01:00:27,646 - data_processing.loader - INFO - Loading latest 'benefit' financial data for 000887.
2025-05-05 01:00:27,657 - data_processing.loader - INFO - Loading latest 'balance' financial data for 000887.
2025-05-05 01:00:27,659 - data_processing.loader - WARNING - No financial data found for symbol 000887, report_type 'balance'.
2025-05-05 01:00:27,663 - db.crud - INFO - Retrieving relevant disclosures for symbol '000887' with query: '中鼎股份 主营业务 核心产品 最新进展...'
2025-05-05 01:00:28,487 - db.crud - ERROR - Error during vector search for 000887 with query '中鼎股份 主营业务 核心产品 最新进展...': (psycopg2.errors.UndefinedColumn) 错误:  字段 stock_disclosure.raw_content 不存在
LINE 1: ...te, stock_disclosure.url AS stock_disclosure_url, stock_disc...
                                                             ^

[SQL: SELECT stock_disclosure.id AS stock_disclosure_id, stock_disclosure.symbol AS stock_disclosure_symbol, stock_disclosure.short_name AS stock_disclosure_short_name, stock_disclosure.title AS stock_disclosure_title, stoc
k_disclosure.ann_date AS stock_disclosure_ann_date, stock_disclosure.url AS stock_disclosure_url, stock_disclosure.raw_content AS stock_disclosure_raw_content, stock_disclosure.content_vector AS stock_disclosure_content_vector
FROM stock_disclosure
WHERE stock_disclosure.symbol = %(symbol_1)s AND stock_disclosure.content_vector IS NOT NULL ORDER BY stock_disclosure.content_vector <=> %(content_vector_1)s
 LIMIT %(param_1)s]
[parameters: {'symbol_1': '000887', 'content_vector_1': '[0.1421324759721756,0.0880507379770279,0.45129263401031494,0.43345627188682556,0.8731904029846191,0.08829042315483093,0.28535473346710205,-0.01991119 ... (14948 characters truncated) ... 1196670532,-0.5329172611236572,-0.11277968436479568,-0.5794579386711121,-1.014172911643982,-0.2592531442642212,-1.16629958152771,0.03283322602510452]', 'param_1': 3}]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "D:\project\quant_platform\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "D:\project\quant_platform\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.UndefinedColumn: 错误:  字段 stock_disclosure.raw_content 不存在
LINE 1: ...te, stock_disclosure.url AS stock_disclosure_url, stock_disc...
                                                             ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\project\quant_platform\db\crud.py", line 48, in retrieve_relevant_disclosures
    ).limit(top_k).all()
                   ^^^^^
  File "D:\project\quant_platform\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2704, in all
    return self._iter().all()  # type: ignore
           ^^^^^^^^^^^^
  File "D:\project\quant_platform\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2858, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "D:\project\quant_platform\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\project\quant_platform\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\project\quant_platform\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "D:\project\quant_platform\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "D:\project\quant_platform\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\project\quant_platform\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "D:\project\quant_platform\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\project\quant_platform\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\project\quant_platform\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\project\quant_platform\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "D:\project\quant_platform\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) 错误:  字段 stock_disclosure.raw_content 不存在
LINE 1: ...te, stock_disclosure.url AS stock_disclosure_url, stock_disc...
                                                             ^

[SQL: SELECT stock_disclosure.id AS stock_disclosure_id, stock_disclosure.symbol AS stock_disclosure_symbol, stock_disclosure.short_name AS stock_disclosure_short_name, stock_disclosure.title AS stock_disclosure_title, stoc
k_disclosure.ann_date AS stock_disclosure_ann_date, stock_disclosure.url AS stock_disclosure_url, stock_disclosure.raw_content AS stock_disclosure_raw_content, stock_disclosure.content_vector AS stock_disclosure_content_vector
FROM stock_disclosure
WHERE stock_disclosure.symbol = %(symbol_1)s AND stock_disclosure.content_vector IS NOT NULL ORDER BY stock_disclosure.content_vector <=> %(content_vector_1)s
 LIMIT %(param_1)s]
[parameters: {'symbol_1': '000887', 'content_vector_1': '[0.1421324759721756,0.0880507379770279,0.45129263401031494,0.43345627188682556,0.8731904029846191,0.08829042315483093,0.28535473346710205,-0.01991119 ... (14948 characters truncated) ... 1196670532,-0.5329172611236572,-0.11277968436479568,-0.5794579386711121,-1.014172911643982,-0.2592531442642212,-1.16629958152771,0.03283322602510452]', 'param_1': 3}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-05-05 01:00:28,490 - core.prompting - INFO - No KB results found for query: '中鼎股份 主营业务 核心产品 最新进展...'
2025-05-05 01:00:28,490 - db.crud - INFO - Retrieving relevant disclosures for symbol '000887' with query: '中鼎股份 竞争优势 风险因素 护城河...'
2025-05-05 01:00:28,538 - db.crud - ERROR - Error during vector search for 000887 with query '中鼎股份 竞争优势 风险因素 护城河...': (psycopg2.errors.InFailedSqlTransaction) 错误:  当前事务被终止, 事务块结束之前的查询被忽略

[SQL: SELECT stock_disclosure.id AS stock_disclosure_id, stock_disclosure.symbol AS stock_disclosure_symbol, stock_disclosure.short_name AS stock_disclosure_short_name, stock_disclosure.title AS stock_disclosure_title, stoc
k_disclosure.ann_date AS stock_disclosure_ann_date, stock_disclosure.url AS stock_disclosure_url, stock_disclosure.raw_content AS stock_disclosure_raw_content, stock_disclosure.content_vector AS stock_disclosure_content_vector
FROM stock_disclosure
WHERE stock_disclosure.symbol = %(symbol_1)s AND stock_disclosure.content_vector IS NOT NULL ORDER BY stock_disclosure.content_vector <=> %(content_vector_1)s
 LIMIT %(param_1)s]
[parameters: {'symbol_1': '000887', 'content_vector_1': '[0.02836434729397297,-0.09604828804731369,0.3034983277320862,-0.056027572602033615,1.056670904159546,-0.2146601527929306,-0.12662938237190247,0.35689 ... (14936 characters truncated) ... 009155,-0.32451367378234863,-0.12990963459014893,0.4171994626522064,-0.2231833040714264,0.03504233807325363,-0.7470990419387817,-0.06531684845685959]', 'param_1': 3}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
Traceback (most recent call last):
  File "D:\project\quant_platform\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "D:\project\quant_platform\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: 错误:  当前事务被终止, 事务块结束之前的查询被忽略


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\project\quant_platform\db\crud.py", line 48, in retrieve_relevant_disclosures
    ).limit(top_k).all()
                   ^^^^^
  File "D:\project\quant_platform\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2704, in all
    return self._iter().all()  # type: ignore
           ^^^^^^^^^^^^
  File "D:\project\quant_platform\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2858, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "D:\project\quant_platform\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\project\quant_platform\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\project\quant_platform\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "D:\project\quant_platform\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "D:\project\quant_platform\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\project\quant_platform\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "D:\project\quant_platform\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\project\quant_platform\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\project\quant_platform\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\project\quant_platform\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "D:\project\quant_platform\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) 错误:  当前事务被终止, 事务块结束之前的查询被忽略

[SQL: SELECT stock_disclosure.id AS stock_disclosure_id, stock_disclosure.symbol AS stock_disclosure_symbol, stock_disclosure.short_name AS stock_disclosure_short_name, stock_disclosure.title AS stock_disclosure_title, stoc
k_disclosure.ann_date AS stock_disclosure_ann_date, stock_disclosure.url AS stock_disclosure_url, stock_disclosure.raw_content AS stock_disclosure_raw_content, stock_disclosure.content_vector AS stock_disclosure_content_vector
FROM stock_disclosure
WHERE stock_disclosure.symbol = %(symbol_1)s AND stock_disclosure.content_vector IS NOT NULL ORDER BY stock_disclosure.content_vector <=> %(content_vector_1)s
 LIMIT %(param_1)s]
[parameters: {'symbol_1': '000887', 'content_vector_1': '[0.02836434729397297,-0.09604828804731369,0.3034983277320862,-0.056027572602033615,1.056670904159546,-0.2146601527929306,-0.12662938237190247,0.35689 ... (14936 characters truncated) ... 009155,-0.32451367378234863,-0.12990963459014893,0.4171994626522064,-0.2231833040714264,0.03504233807325363,-0.7470990419387817,-0.06531684845685959]', 'param_1': 3}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-05-05 01:00:28,541 - core.prompting - INFO - No KB results found for query: '中鼎股份 竞争优势 风险因素 护城河...'
2025-05-05 01:00:28,541 - db.crud - INFO - Retrieving relevant disclosures for symbol '000887' with query: '中鼎股份 财务分析 管理层讨论...'
2025-05-05 01:00:28,590 - db.crud - ERROR - Error during vector search for 000887 with query '中鼎股份 财务分析 管理层讨论...': (psycopg2.errors.InFailedSqlTransaction) 错误:  当前事务被终止, 事务块结束之前的查询被忽略

[SQL: SELECT stock_disclosure.id AS stock_disclosure_id, stock_disclosure.symbol AS stock_disclosure_symbol, stock_disclosure.short_name AS stock_disclosure_short_name, stock_disclosure.title AS stock_disclosure_title, stoc
k_disclosure.ann_date AS stock_disclosure_ann_date, stock_disclosure.url AS stock_disclosure_url, stock_disclosure.raw_content AS stock_disclosure_raw_content, stock_disclosure.content_vector AS stock_disclosure_content_vector
FROM stock_disclosure
WHERE stock_disclosure.symbol = %(symbol_1)s AND stock_disclosure.content_vector IS NOT NULL ORDER BY stock_disclosure.content_vector <=> %(content_vector_1)s
 LIMIT %(param_1)s]
[parameters: {'symbol_1': '000887', 'content_vector_1': '[-0.06410510092973709,0.26490411162376404,0.34549808502197266,0.32625484466552734,1.0131741762161255,-0.8310586810112,0.5267392992973328,0.4629521965 ... (14951 characters truncated) ... 1534424,-0.5827626585960388,-0.21250276267528534,-0.1608276069164276,-0.9933063983917236,-0.5189839005470276,-0.8376201391220093,0.13272354006767273]', 'param_1': 3}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
Traceback (most recent call last):
  File "D:\project\quant_platform\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "D:\project\quant_platform\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: 错误:  当前事务被终止, 事务块结束之前的查询被忽略


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\project\quant_platform\db\crud.py", line 48, in retrieve_relevant_disclosures
    ).limit(top_k).all()
                   ^^^^^
  File "D:\project\quant_platform\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2704, in all
    return self._iter().all()  # type: ignore
           ^^^^^^^^^^^^
  File "D:\project\quant_platform\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2858, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "D:\project\quant_platform\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\project\quant_platform\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\project\quant_platform\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "D:\project\quant_platform\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "D:\project\quant_platform\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\project\quant_platform\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "D:\project\quant_platform\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\project\quant_platform\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\project\quant_platform\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\project\quant_platform\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "D:\project\quant_platform\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) 错误:  当前事务被终止, 事务块结束之前的查询被忽略

[SQL: SELECT stock_disclosure.id AS stock_disclosure_id, stock_disclosure.symbol AS stock_disclosure_symbol, stock_disclosure.short_name AS stock_disclosure_short_name, stock_disclosure.title AS stock_disclosure_title, stoc
k_disclosure.ann_date AS stock_disclosure_ann_date, stock_disclosure.url AS stock_disclosure_url, stock_disclosure.raw_content AS stock_disclosure_raw_content, stock_disclosure.content_vector AS stock_disclosure_content_vector
FROM stock_disclosure
WHERE stock_disclosure.symbol = %(symbol_1)s AND stock_disclosure.content_vector IS NOT NULL ORDER BY stock_disclosure.content_vector <=> %(content_vector_1)s
 LIMIT %(param_1)s]
[parameters: {'symbol_1': '000887', 'content_vector_1': '[-0.06410510092973709,0.26490411162376404,0.34549808502197266,0.32625484466552734,1.0131741762161255,-0.8310586810112,0.5267392992973328,0.4629521965 ... (14951 characters truncated) ... 1534424,-0.5827626585960388,-0.21250276267528534,-0.1608276069164276,-0.9933063983917236,-0.5189839005470276,-0.8376201391220093,0.13272354006767273]', 'param_1': 3}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-05-05 01:00:28,598 - core.prompting - INFO - No KB results found for query: '中鼎股份 财务分析 管理层讨论...'
2025-05-05 01:00:28,598 - db.crud - INFO - Retrieving relevant disclosures for symbol '000887' with query: '中鼎股份 股权激励 回购 调研 纪要 最新公告...'
2025-05-05 01:00:28,647 - db.crud - ERROR - Error during vector search for 000887 with query '中鼎股份 股权激励 回购 调研 纪要 最新公告...': (psycopg2.errors.InFailedSqlTransaction) 错误:  当前事务被终止, 事务块结束之前的查被忽略

[SQL: SELECT stock_disclosure.id AS stock_disclosure_id, stock_disclosure.symbol AS stock_disclosure_symbol, stock_disclosure.short_name AS stock_disclosure_short_name, stock_disclosure.title AS stock_disclosure_title, stoc
k_disclosure.ann_date AS stock_disclosure_ann_date, stock_disclosure.url AS stock_disclosure_url, stock_disclosure.raw_content AS stock_disclosure_raw_content, stock_disclosure.content_vector AS stock_disclosure_content_vector
FROM stock_disclosure
WHERE stock_disclosure.symbol = %(symbol_1)s AND stock_disclosure.content_vector IS NOT NULL ORDER BY stock_disclosure.content_vector <=> %(content_vector_1)s
 LIMIT %(param_1)s]
[parameters: {'symbol_1': '000887', 'content_vector_1': '[-0.20400342345237732,0.18467062711715698,-0.23781275749206543,0.4165419936180115,0.3188849985599518,-0.4042224884033203,0.21897466480731964,0.242816 ... (14963 characters truncated) ... 24313354,-0.028260624036192894,0.4565996527671814,-0.4482012391090393,-0.1092873364686966,-0.4724557399749756,-1.2884302139282227,0.2524164319038391]', 'param_1': 3}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
Traceback (most recent call last):
  File "D:\project\quant_platform\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "D:\project\quant_platform\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: 错误:  当前事务被终止, 事务块结束之前的查询被忽略


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\project\quant_platform\db\crud.py", line 48, in retrieve_relevant_disclosures
    ).limit(top_k).all()
                   ^^^^^
  File "D:\project\quant_platform\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2704, in all
    return self._iter().all()  # type: ignore
           ^^^^^^^^^^^^
  File "D:\project\quant_platform\.venv\Lib\site-packages\sqlalchemy\orm\query.py", line 2858, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "D:\project\quant_platform\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\project\quant_platform\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\project\quant_platform\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "D:\project\quant_platform\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "D:\project\quant_platform\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\project\quant_platform\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "D:\project\quant_platform\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\project\quant_platform\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\project\quant_platform\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\project\quant_platform\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "D:\project\quant_platform\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) 错误:  当前事务被终止, 事务块结束之前的查询被忽略

[SQL: SELECT stock_disclosure.id AS stock_disclosure_id, stock_disclosure.symbol AS stock_disclosure_symbol, stock_disclosure.short_name AS stock_disclosure_short_name, stock_disclosure.title AS stock_disclosure_title, stock_disclosure.ann_date AS stock_disclosure_ann_date, stock_disclosure.url AS stock_disclosure_url, stock_disclosure.raw_content AS stock_disclosure_raw_content, stock_disclosure.content_vector AS stock_disclosure_content_vector
FROM stock_disclosure
WHERE stock_disclosure.symbol = %(symbol_1)s AND stock_disclosure.content_vector IS NOT NULL ORDER BY stock_disclosure.content_vector <=> %(content_vector_1)s
 LIMIT %(param_1)s]
[parameters: {'symbol_1': '000887', 'content_vector_1': '[-0.20400342345237732,0.18467062711715698,-0.23781275749206543,0.4165419936180115,0.3188849985599518,-0.4042224884033203,0.21897466480731964,0.242816 ... (14963 characters truncated) ... 24313354,-0.028260624036192894,0.4565996527671814,-0.4482012391090393,-0.1092873364686966,-0.4724557399749756,-1.2884302139282227,0.2524164319038391]', 'param_1': 3}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-05-05 01:00:28,649 - core.prompting - INFO - No KB results found for query: '中鼎股份 股权激励 回购 调研 纪要 最新公告...'
2025-05-05 01:00:28,649 - core.prompting - INFO - Retrieving recent web information...
2025-05-05 01:00:28,649 - integrations.web_search - INFO - Querying Google CSE with params: {'key': '[REDACTED]', 'cx': '533a067c36f9d48f1', 'q': '中鼎股份 000887 股票分析 OR 公司新闻 OR 最新研究报告', 'num': 3, 'dateRestrict': 'm6'}
2025-05-05 01:00:31,905 - integrations.web_search - INFO - Received 3 results from Google CSE for query: '中鼎股份 000887 股票分析 OR 公司新闻 OR 最新研究报告'
2025-05-05 01:00:32,313 - integrations.web_search - INFO - Querying Google CSE with params: {'key': '[REDACTED]', 'cx': '533a067c36f9d48f1', 'q': '中鼎股份 000887', 'num': 2, 'dateRestrict': 'm6', 'siteSearch': 'eastmoney.com'}

2025-05-05 01:00:35,430 - integrations.web_search - INFO - Received 2 results from Google CSE for query: '中鼎股份 000887', site: eastmoney.com
2025-05-05 01:00:35,948 - integrations.web_search - INFO - Querying Google CSE with params: {'key': '[REDACTED]', 'cx': '533a067c36f9d48f1', 'q': '中鼎股份 000887', 'num': 2, 'dateRestrict': 'm6', 'siteSearch': '10jqka.com.cn'}
2025-05-05 01:00:39,066 - integrations.web_search - INFO - Received 2 results from Google CSE for query: '中鼎股份 000887', site: 10jqka.com.cn
2025-05-05 01:00:39,685 - integrations.web_search - INFO - Querying Google CSE with params: {'key': '[REDACTED]', 'cx': '533a067c36f9d48f1', 'q': '中鼎股份 000887', 'num': 2, 'dateRestrict': 'm6', 'siteSearch': 'xueqiu.com'}
2025-05-05 01:00:42,735 - integrations.web_search - INFO - Received 2 results from Google CSE for query: '中鼎股份 000887', site: xueqiu.com
2025-05-05 01:00:43,265 - integrations.web_search - INFO - Querying Google CSE with params: {'key': '[REDACTED]', 'cx': '533a067c36f9d48f1', 'q': '中鼎股份 000887', 'num': 2, 'dateRestrict': 'm6', 'siteSearch': 'finance.sinm.cn'}
2025-05-05 01:00:46,229 - integrations.web_search - INFO - Received 2 results from Google CSE for query: '中鼎股份 000887', site: finance.sina.com.cn
2025-05-05 01:00:46,230 - integrations.web_search - INFO - Collected 11 unique web results using Google CSE for 000887 中鼎股份.
2025-05-05 01:00:46,230 - core.prompting - INFO - Calling local LLM to generate the report...
2025-05-05 01:00:46,230 - core.prompting - INFO - Calling local Ollama model: 'qwen3:14b'. Prompt length: 3681 chars.
2025-05-05 01:02:48,254 - httpx - INFO - HTTP Request: POST http://127.0.0.1:11434/api/generate "HTTP/1.1 503 Service Unavailable"
2025-05-05 01:02:48,258 - core.prompting - ERROR - Ollama API Error: Status Code 503, Error:
Traceback (most recent call last):
  File "D:\project\quant_platform\core\prompting.py", line 33, in call_local_llm
    response = ollama.generate(
               ^^^^^^^^^^^^^^^^
  File "D:\project\quant_platform\.venv\Lib\site-packages\ollama\_client.py", line 242, in generate
    return self._request(
           ^^^^^^^^^^^^^^
  File "D:\project\quant_platform\.venv\Lib\site-packages\ollama\_client.py", line 178, in _request
    return cls(**self._request_raw(*args, **kwargs).json())
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\project\quant_platform\.venv\Lib\site-packages\ollama\_client.py", line 122, in _request_raw
    raise ResponseError(e.response.text, e.response.status_code) from None
ollama._types.ResponseError:  (status code: 503)
2025-05-05 01:02:48,278 - core.prompting - ERROR - Report generation failed for 000887. LLM Error: Error: Ollama API request failed (503 - ). Ensure Ollama server is running and model 'qwen3:14b' is available/pulled.
2025-05-05 01:02:48,286 - __main__ - ERROR - Report generation failed for 000887. No report to save or send.
2025-05-05 01:02:48,286 - __main__ - INFO - --- Stock Analysis for 000887 Finished. Total time: 141.22 seconds ---
(.venv) PS D:\project\quant_platform> python main.py 000887
2025-05-05 01:24:54,830 - __main__ - INFO - .env file loaded (if exists).
2025-05-05 01:24:54,832 - __main__ - INFO - --- Starting Stock Analysis for: 000887 ---
2025-05-05 01:24:54,832 - db.database - INFO - Creating database tables if they don't exist...
2025-05-05 01:24:55,190 - db.database - INFO - Database tables checked/created successfully.
2025-05-05 01:24:55,190 - __main__ - INFO - --- Starting Data Processing for: 000887 ---
2025-05-05 01:24:55,190 - data_processing.loader - INFO - Querying database for disclosures needing content for symbol: 000887
2025-05-05 01:24:55,287 - data_processing.loader - INFO - Found 107 disclosures needing content for 000887.
2025-05-05 01:24:55,287 - __main__ - INFO - Found 107 disclosures to process for 000887.
2025-05-05 01:24:55,287 - __main__ - INFO - Processing Disclosure ID: 591270, Title: 2024年年度报告摘要...
2025-05-05 01:24:55,288 - data_processing.scraper - INFO - Fetching announcement: '2024年年度报告摘要' from http://www.cninfo.com.cn/new/disclosure/detail?stockCode=000887&announcementId=1223369539&orgId=gssz0000887&announcementTime=2025-04-29 00:00:00

DevTools listening on ws://127.0.0.1:2876/devtools/browser/e0661ba0-f3e0-4377-bdf5-5e730dc793f1
[61204:54780:0505/012503.323:ERROR:direct_composition_support.cc(1070)] QueryInterface to IDCompositionDevice4 failed: 涓嶆敮鎸佹鎺ュ彛 (0x80004002)
Created TensorFlow Lite XNNPACK delegate for CPU.
2025-05-05 01:25:30,332 - data_processing.scraper - ERROR - Dynamic wait failed for css='div.main-content': Message:
Stacktrace:
        GetHandleVerifier [0x00007FF75872C6A5+28789]
        (No symbol) [0x00007FF758695B20]
        (No symbol) [0x00007FF758528F9A]
        (No symbol) [0x00007FF75857F346]
        (No symbol) [0x00007FF75857F57C]
        (No symbol) [0x00007FF7585D2B17]
        (No symbol) [0x00007FF7585A736F]
        (No symbol) [0x00007FF7585CF7E3]
        (No symbol) [0x00007FF7585A7103]
        (No symbol) [0x00007FF75856FFC0]
        (No symbol) [0x00007FF758571273]
        GetHandleVerifier [0x00007FF758A71AED+3458237]
        GetHandleVerifier [0x00007FF758A8829C+3550316]
        GetHandleVerifier [0x00007FF758A7DB9D+3507565]
        GetHandleVerifier [0x00007FF7587F2C6A+841274]
        (No symbol) [0x00007FF7586A09EF]
        (No symbol) [0x00007FF75869CB34]
        (No symbol) [0x00007FF75869CCD6]
        (No symbol) [0x00007FF75868C119]
        BaseThreadInitThunk [0x00007FFC4C267374+20]
        RtlUserThreadStart [0x00007FFC4D01CC91+33]

2025-05-05 01:25:30,346 - data_processing.scraper - WARNING - No PDF links found on page http://www.cninfo.com.cn/new/disclosure/detail?stockCode=000887&announcementId=1223369539&orgId=gssz0000887&announcementTime=2025-04-29 00:00:00 using Selenium.
2025-05-05 01:25:32,594 - data_processing.scraper - ERROR - Failed to obtain PDF stream for 2024年年度报告摘要 from http://www.cninfo.com.cn/new/disclosure/detail?stockCode=000887&announcementId=1223369539&orgId=gssz0000887&announcementTime=2025-04-29 00:00:00 (or derived URL http://www.cninfo.com.cn/new/disclosure/detail?stockCode=000887&announcementId=1223369539&orgId=gssz0000887&announcementTime=2025-04-29 00:00:00).
2025-05-05 01:25:32,594 - __main__ - WARNING - Failed to fetch/extract text for Disclosure ID: 591270. Skipping.
2025-05-05 01:25:32,594 - __main__ - INFO - Processing Disclosure ID: 591288, Title: 2024年年度报告...
2025-05-05 01:25:32,595 - data_processing.scraper - INFO - Fetching announcement: '2024年年度报告' from http://www.cninfo.com.cn/new/disclosure/detail?stockCode=000887&announcementId=1223369489&orgId=gssz0000887&announcementTime=2025-04-29 00:00:00

DevTools listening on ws://127.0.0.1:3047/devtools/browser/af2e47e3-e0db-464a-b6d3-5af0009dff90
[63740:45452:0505/012535.162:ERROR:direct_composition_support.cc(1070)] QueryInterface to IDCompositionDevice4 failed: 涓嶆敮鎸佹鎺ュ彛 (0x80004002)
Created TensorFlow Lite XNNPACK delegate for CPU.
2025-05-05 01:26:01,969 - data_processing.scraper - ERROR - Dynamic wait failed for css='div.main-content': Message:
Stacktrace:
        GetHandleVerifier [0x00007FF75872C6A5+28789]
        (No symbol) [0x00007FF758695B20]
        (No symbol) [0x00007FF758528F9A]
        (No symbol) [0x00007FF75857F346]
        (No symbol) [0x00007FF75857F57C]
        (No symbol) [0x00007FF7585D2B17]
        (No symbol) [0x00007FF7585A736F]
        (No symbol) [0x00007FF7585CF7E3]
        (No symbol) [0x00007FF7585A7103]
        (No symbol) [0x00007FF75856FFC0]
        (No symbol) [0x00007FF758571273]
        GetHandleVerifier [0x00007FF758A71AED+3458237]
        GetHandleVerifier [0x00007FF758A8829C+3550316]
        GetHandleVerifier [0x00007FF758A7DB9D+3507565]
        GetHandleVerifier [0x00007FF7587F2C6A+841274]
        (No symbol) [0x00007FF7586A09EF]
        (No symbol) [0x00007FF75869CB34]
        (No symbol) [0x00007FF75869CCD6]
        (No symbol) [0x00007FF75868C119]
        BaseThreadInitThunk [0x00007FFC4C267374+20]
        RtlUserThreadStart [0x00007FFC4D01CC91+33]

2025-05-05 01:26:01,971 - data_processing.scraper - WARNING - No PDF links found on page http://www.cninfo.com.cn/new/disclosure/detail?stockCode=000887&announcementId=1223369489&orgId=gssz0000887&announcementTime=2025-04-29 00:00:00 using Selenium.
2025-05-05 01:26:04,051 - data_processing.scraper - ERROR - Failed to obtain PDF stream for 2024年年度报告 from http://www.cninfo.com.cn/new/disclosure/detail?stockCode=000887&announcementId=1223369489&orgId=gssz0000887&announcementTime=2025-04-29 00:00:00 (or derived URL http://www.cninfo.com.cn/new/disclosure/detail?stockCode=000887&announcementId=1223369489&orgId=gssz0000887&announcementTime=2025-04-29 00:00:00).
2025-05-05 01:26:04,051 - __main__ - WARNING - Failed to fetch/extract text for Disclosure ID: 591288. Skipping.
2025-05-05 01:26:04,051 - __main__ - INFO - Processing Disclosure ID: 591329, Title: 2024年半年度报告摘要...
2025-05-05 01:26:04,051 - data_processing.scraper - INFO - Fetching announcement: '2024年半年度报告摘要' from http://www.cninfo.com.cn/new/disclosure/detail?stockCode=000887&announcementId=1221083689&orgId=gssz0000887&announcementTime=2024-08-31 00:00:00

DevTools listening on ws://127.0.0.1:3250/devtools/browser/c5059972-d6d5-46fb-928d-22d137b3792c
[63880:52824:0505/012605.904:ERROR:direct_composition_support.cc(1070)] QueryInterface to IDCompositionDevice4 failed: 涓嶆敮鎸佹鎺ュ彛 (0x80004002)
Created TensorFlow Lite XNNPACK delegate for CPU.
2025-05-05 01:26:33,125 - data_processing.scraper - ERROR - Dynamic wait failed for css='div.main-content': Message:
Stacktrace:
        GetHandleVerifier [0x00007FF75872C6A5+28789]
        (No symbol) [0x00007FF758695B20]
        (No symbol) [0x00007FF758528F9A]
        (No symbol) [0x00007FF75857F346]
        (No symbol) [0x00007FF75857F57C]
        (No symbol) [0x00007FF7585D2B17]
        (No symbol) [0x00007FF7585A736F]
        (No symbol) [0x00007FF7585CF7E3]
        (No symbol) [0x00007FF7585A7103]
        (No symbol) [0x00007FF75856FFC0]
        (No symbol) [0x00007FF758571273]
        GetHandleVerifier [0x00007FF758A71AED+3458237]
        GetHandleVerifier [0x00007FF758A8829C+3550316]
        GetHandleVerifier [0x00007FF758A7DB9D+3507565]
        GetHandleVerifier [0x00007FF7587F2C6A+841274]
        (No symbol) [0x00007FF7586A09EF]
        (No symbol) [0x00007FF75869CB34]
        (No symbol) [0x00007FF75869CCD6]
        (No symbol) [0x00007FF75868C119]
        BaseThreadInitThunk [0x00007FFC4C267374+20]
        RtlUserThreadStart [0x00007FFC4D01CC91+33]

2025-05-05 01:26:33,137 - data_processing.scraper - INFO - Found PDF link via Selenium: https://static.cninfo.com.cn/finalpage/2024-08-31/1221083689.PDF
2025-05-05 01:27:04,754 - data_processing.scraper - INFO - Successfully extracted text (length: 6525) from https://static.cninfo.com.cn/finalpage/2024-08-31/1221083689.PDF
2025-05-05 01:27:04,755 - data_processing.scraper - WARNING - Could not extract '管理层讨论与分析', returning full text.
2025-05-05 01:27:04,755 - __main__ - INFO - Successfully scraped text (length: 6525) for Disclosure ID: 591329
2025-05-05 01:27:04,755 - core.vectorizer - WARNING - Document text truncated for embedding (original: 6525 chars, limit: ~1275 chars, truncated: 1275 chars). Consider implementing text chunking.
2025-05-05 01:27:06,084 - __main__ - INFO - Successfully generated embedding vector for Disclosure ID: 591329
2025-05-05 01:27:06,088 - db.crud - INFO - Updated fields ['raw_content', 'content_vector'] for disclosure ID 591329.
2025-05-05 01:27:06,088 - __main__ - ERROR - Unhandled error processing Disclosure ID 591329: name 'random' is not defined
Traceback (most recent call last):
  File "D:\project\quant_platform\main.py", line 87, in run_data_processing
    time.sleep(random.uniform(1, 3))
               ^^^^^^
NameError: name 'random' is not defined. Did you forget to import 'random'
2025-05-05 01:27:06,088 - __main__ - INFO - Processing Disclosure ID: 591330, Title: 2024年半年度报告...
2025-05-05 01:27:06,089 - data_processing.scraper - INFO - Fetching announcement: '2024年半年度报告' from http://www.cninfo.com.cn/new/disclosure/detail?stockCode=000887&announcementId=1221083688&orgId=gssz0000887&announcementTime=2024-08-31 00:00:00

DevTools listening on ws://127.0.0.1:3633/devtools/browser/991de9ec-b2c4-47b9-8612-2530979cbf5a
[47596:69636:0505/012708.813:ERROR:direct_composition_support.cc(1070)] QueryInterface to IDCompositionDevice4 failed: 涓嶆敮鎸佹鎺ュ彛 (0x80004002)
Created TensorFlow Lite XNNPACK delegate for CPU.
2025-05-05 01:27:35,229 - data_processing.scraper - ERROR - Dynamic wait failed for css='div.main-content': Message:
Stacktrace:
        GetHandleVerifier [0x00007FF75872C6A5+28789]
        (No symbol) [0x00007FF758695B20]
        (No symbol) [0x00007FF758528F9A]
        (No symbol) [0x00007FF75857F346]
        (No symbol) [0x00007FF75857F57C]
        (No symbol) [0x00007FF7585D2B17]
        (No symbol) [0x00007FF7585A736F]
        (No symbol) [0x00007FF7585CF7E3]
        (No symbol) [0x00007FF7585A7103]
        (No symbol) [0x00007FF75856FFC0]
        (No symbol) [0x00007FF758571273]
        GetHandleVerifier [0x00007FF758A71AED+3458237]
        GetHandleVerifier [0x00007FF758A8829C+3550316]
        GetHandleVerifier [0x00007FF758A7DB9D+3507565]
        GetHandleVerifier [0x00007FF7587F2C6A+841274]
        (No symbol) [0x00007FF7586A09EF]
        (No symbol) [0x00007FF75869CB34]
        (No symbol) [0x00007FF75869CCD6]
        (No symbol) [0x00007FF75868C119]
        BaseThreadInitThunk [0x00007FFC4C267374+20]
        RtlUserThreadStart [0x00007FFC4D01CC91+33]

2025-05-05 01:27:35,238 - data_processing.scraper - INFO - Found PDF link via Selenium: https://static.cninfo.com.cn/finalpage/2024-08-31/1221083688.PDF

